<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Amelia McNamara" />


<title>Making maps</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="include/smith.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SDS 236 - Spring 2018</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="DataDiary.html">Data Diary</a>
    </li>
    <li>
      <a href="Wikipedia.html">Wikipedia</a>
    </li>
    <li>
      <a href="OneNumberStory.html">One-number story</a>
    </li>
    <li>
      <a href="FOIAtheDead.html">FOIA the dead</a>
    </li>
    <li>
      <a href="OneVariablePlot.html">One-variable visualization</a>
    </li>
    <li>
      <a href="ScienceReporting.html">Science reporting</a>
    </li>
    <li>
      <a href="FreeingData.html">Freeing data from PDFs</a>
    </li>
    <li>
      <a href="StandardStory.html">Standard Story</a>
    </li>
    <li>
      <a href="MakingMaps.html">Making maps</a>
    </li>
    <li>
      <a href="https://ameliamn.shinyapps.io/Interactives/">Interactives</a>
    </li>
    <li>
      <a href="FinalProject.html">Final project</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://get.slack.help/hc/en-us/articles/218080037-Getting-started-for-new-users">Getting started with Slack</a>
    </li>
    <li>
      <a href="https://www.smith.edu/qlc/tutoring.html#D1">Data Assistants</a>
    </li>
    <li>
      <a href="http://libguides.smith.edu/news">Finding News</a>
    </li>
    <li>
      <a href="http://libguides.smith.edu/c.php?g=813426">Library guide for SDS 236</a>
    </li>
    <li>
      <a href="https://www.significancemagazine.com/component/content/article/10-news/579-our-2018-writing-competition-for-early-career-statisticians-is-underway">Significance writing competition</a>
    </li>
    <li>
      <a href="WritingTips.html">Writing tips</a>
    </li>
    <li>
      <a href="https://www.tableau.com/learn/training">Tableau tutorials</a>
    </li>
    <li>
      <a href="http://happygitwithr.com/">Happy git with R</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Making maps</h1>
<h4 class="author"><em>Amelia McNamara</em></h4>

</div>


<div id="assignment" class="section level2">
<h2>Assignment</h2>
<p>Your assignment is to create a choropleth map of an issue. It should incorperate a shapefile (such as states or zipcodes) and some data you believe it makes journalistic sense to map. You <em>cannot</em> use the Happiness polling data I demoed on, but you can use the state shapefile with a different Gallup question. You could also choose to go further and get zipcode shapefiles and visualize BLL data, or any other shapefile/data connection you can dream up!</p>
<p>Like the data visualization assignment, I would like a little text to support the map. Think of a headline/title, and 2-3 sentences explaining the lede/nutgraph of your mapped story. This can be submitted as part of the same document, or separately.</p>
</div>
<div id="when-to-make-a-map" class="section level2">
<h2>When to make a map?</h2>
<p>When you have geographic data! Maps are very popular in data journalism because almost all readers have some geographic context, so they can “see themselves” in the map.</p>
</div>
<div id="when-not-to-make-a-map" class="section level2">
<h2>When not to make a map?</h2>
<p>When the geographic information doesn’t add anything to the story. Matthew Ericson has <a href="http://www.ericson.net/content/2011/10/when-maps-shouldnt-be-maps/">some thoughts</a> about when maps shouldn’t be maps.</p>
</div>
<div id="geographic-data" class="section level2">
<h2>Geographic data</h2>
<p>There are three main types: points, lines, and polygons.</p>
<ul>
<li>Points are useful when you’re interested in the very specific latitute/longitude location of something– where people are, where crimes occurred, etc.</li>
<li>Lines are probably the least-used type, but could be used to show routes, rivers, roads, etc.</li>
<li>Polygons (essentially, shapes) are used to show areas. There are many spatial polygons that get used to delineate where humans live– states, counties, school districts, voting districts, zipcodes, etc.</li>
</ul>
<p>We’ll be focusing on polygons, but most of this stuff generalizes pretty well to the other types of geographic data.</p>
</div>
<div id="getting-polling-data" class="section level2">
<h2>Getting polling data</h2>
<p>I grabbed some polling data from Gallup for us to map. I chose the response about experiencing happiness, but you could choose a different question if one interests you more.</p>
<p>To get this data, go to <a href="https://ly.smith.edu/ef/00035">the Gallup website</a>. I think this only works from on-campus. If that link doesn’t work, try going to <a href="http://libguides.smith.edu/c.php?g=813426&amp;p=5812718">the library guide for Data Journalism</a> and clicking through the link there.</p>
<p>Once you’re on the site, you can browse however you’d like. I recommend choosing:</p>
<ul>
<li>Find data by: Geography</li>
<li>In the Geography dropdown, select “United States (All geographies/areas)”</li>
<li>This will take you to a Summary page, where Gallup will recommend some metrics. You can browse here, but when you’re ready to download data…</li>
<li>Select Tables (at the upper left of the screen)</li>
<li>Make sure there is something in Geographies. Use the plus icon if there isn’t, and again, pick “United States (All geographies/areas)”</li>
<li>Make sure there is something in Metrics. Use the plus icon if there isn’t, and select the question you’re interested in. I chose:
<ul>
<li>Well-being</li>
<li>Experienced Happiness Yesterday</li>
</ul></li>
<li>Make sure there is something in Time. I x-ed out of all the years except for 2016, to keep it simple</li>
<li>Look at the preview of data, and decide whether you want Formatted or Unformatted (radio buttons in the upper right). I picked Unformatted, but it doesn’t really matter.</li>
<li>Click Export!</li>
</ul>
</div>
<div id="getting-data-into-rstudio" class="section level2">
<h2>Getting data into RStudio</h2>
<p>If you are working on the server, there is a three-part process to getting data into R/RStudio. You need to:</p>
<ul>
<li><strong>Download</strong></li>
<li><strong>Upload</strong></li>
<li><strong>Load</strong></li>
</ul>
<p>If you followed the instructions above, you’ve downloaded the data. Now, you’ll need to <strong>upload</strong> it to the RStudio server.</p>
<ul>
<li>Login to rstudio.smith.edu or rstudio-dev.smith.edu</li>
<li>Select the Files tab</li>
<li>Click Upload, and navigate to where your downloaded data is.</li>
</ul>
</div>
<div id="loading-data" class="section level2">
<h2>Loading data</h2>
<p>The final step is to load the data into R. In the DataCamp courses, you’ve seen some different ways to do this. RStudio has a convenience wizard that I like to use when I make my first attempt to load in data. I’ll often refine the code myself later, but using the wizard makes it less of a guess-and-check process.</p>
<p>To use this,</p>
<ul>
<li>click the Environment tab</li>
<li>select Import Dataset</li>
<li>Since the Gallup data came as an .xlsx file, we can select the From Excel option</li>
<li>Look at the previewed version of the data, and adjust the choices at the bottom of the pane. I needed to skip some rows because of the header.</li>
</ul>
<p>Here’s the code I ended up with:</p>
<pre class="r"><code>library(readxl)
GallupAnalytics_Export_20180405_102840 &lt;- read_excel(&quot;Downloads/GallupAnalytics_Export_20180405_102840.xlsx&quot;, skip=6)</code></pre>
<p>Now, we have a flat, “tidy” file of people’s happiness in the States. But, it doesn’t have any polygons.</p>
</div>
<div id="shapefiles" class="section level2">
<h2>Shapefiles</h2>
<p>There’s one more piece of data you will need to make a map, and that’s a “shapefile” (basically, a set of outlines of whatever polygon you’re interested in).</p>
<p>In this case, we need the outlines of the states to be able to plot them. I got my shapefile by googling “census states shapefile.” The first result was <a href="https://www.census.gov/geo/maps-data/data/tiger-cart-boundary.html">this</a>, so I scrolled down to State and clicked that.</p>
<p>There are files from every year, because some boundaries change over time (like voting districts). States are <strong>pretty</strong> stable, so it doesn’t really matter which you grab. You can choose the resolution you want, but for our purposes we don’t need anything too fine-grained. I chose 1:500,000k.</p>
</div>
<div id="reading-in-shapefiles" class="section level2">
<h2>Reading in shapefiles</h2>
<p>Just like flat files, you need to Download, Upload, and Load your data to get R to know about it. Hopefully you’ve completed the <strong>Download</strong> part, and have a zip file.</p>
<p>When you <strong>Upload</strong> to RStudio, upload the zip file as-is, and RStudio should automatically un-zip it into a folder containing a bunch of similarly-name files with weird file extensions. Different spatial analysis packages use different numbers of those files, so it’s a good idea to just leave all of them there. Once you have that folder, you can load the data.</p>
<p>The <strong>Load</strong> part is going to be different for this special (and spatial) data type. We’ll use the old-school way, using <code>readOGR</code>, but there’s a new package called <code>sf</code> that is gaining traction as well. Here’s how <code>readOGR</code> works:</p>
<pre class="r"><code>library(rgdal)
states_rgdal &lt;- readOGR(&quot;Downloads/cb_2015_us_state_500k/&quot;, layer=&quot;cb_2015_us_state_500k&quot;)</code></pre>
<p>It looks a little repetitive here, but that first quoted string is the filepath to my folder. I stuck my folder right in my “working directory” (check yours by running <code>getwd()</code> in your Console), but you can store the folder anywhere you want as long as you have the filepath correct. If I was working on my local computer, that filepath might be “/Users/amelia/Documents/cb_2015_us_state_500k” (note that filepaths are different on Windows and Mac)</p>
<p>The second argument to the function is the name of the files themselves. To make my life easier, I always just leave these the same as the name of the folder. Notice there’s no trailing slash here. And, even if I had used the full filepath for the first argument, I’d use the same name for this one.</p>
</div>
<div id="the-sf-way" class="section level2">
<h2>The sf way</h2>
<p>If you’re on dev-rstudio.edu, you can use the <code>sf</code> package. It reads in shapefiles differently:</p>
<pre class="r"><code>library(sf)
states_sf &lt;- st_read(&quot;Downloads/cb_2015_us_state_500k/&quot;)</code></pre>
<p>Notice that this looks a lot more like a “flat” dataset, but with a <code>geometry</code> column containing the specification for the polygon shape.</p>
</div>
<div id="joining" class="section level2">
<h2>Joining</h2>
<p>In order to use a shapefile with another datset (like the Gallup data we found), we need to join them together.</p>
<p>The way you do the join depends on what datatype your shapefile is in. If you used <code>rgdal</code>, you have to join on the data “slot” (sort of like a variable, but it can contain a whole dataset!). Just follow this code:</p>
<pre class="r"><code>library(dplyr)

states_rgdal@data &lt;- left_join(states_rgdal@data, GallupAnalytics_Export_20180405_102840, by = c(&quot;NAME&quot; = &quot;Geography&quot;))</code></pre>
<p>If you used <code>sf</code>, it’s easier:</p>
<pre class="r"><code>states_sf &lt;- states_sf %&gt;%
  left_join(happiness, by=c(&quot;NAME&quot; = &quot;Geography&quot;))</code></pre>
</div>
<div id="base-plotting" class="section level2">
<h2>Base plotting</h2>
<p>Now that everything is joined, we can plot! Both datsets have some generic base plotting that works okay for checking that your data is there, but it’s not that pretty.</p>
<pre class="r"><code>plot(states_rgdal)
plot(states_sf[&quot;Yes&quot;])</code></pre>
</div>
<div id="leaflet" class="section level2">
<h2>Leaflet</h2>
<p><a href="http://leafletjs.com/">Leaflet</a> is a Javascript library for interactive maps. A bunch of people worked to make an R package that works with leaflet, but you can use leaflet in many more situations (for example, if you do data visualization in d3.js, it’s easy to integrate with leaflet).</p>
<pre class="r"><code># install.packages(&quot;leaflet&quot;)
library(leaflet)

pal &lt;- colorNumeric(
  palette = &quot;Greens&quot;,
  domain = states_rgdal$Yes
)

m &lt;- leaflet(data=states_rgdal) %&gt;%
  addProviderTiles(&quot;Stamen.Watercolor&quot;) %&gt;%
  setView(lng = -98.35, lat = 39.8, zoom = 03) %&gt;%
  addPolygons(stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5, color =~pal(Yes)
  ) %&gt;%
  addLegend(&quot;bottomright&quot;, pal = pal, values = ~Yes,
    title = &quot;Percent of people reporting happiness&quot;,
    opacity = 1
  )</code></pre>
<pre class="r"><code>pal &lt;- colorNumeric(
  palette = &quot;Blues&quot;,
  domain = states_sf$Yes
)

leaflet(data=states_sf) %&gt;%
  addProviderTiles(&quot;Stamen.Watercolor&quot;) %&gt;%
  setView(lng = -98.35, lat = 39.8, zoom = 04) %&gt;%
  addPolygons(stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5, color =~pal(Yes)
  ) %&gt;%
  addLegend(&quot;bottomright&quot;, pal = pal, values = ~Yes,
    title = &quot;Percent of people reporting happiness&quot;,
    opacity = 1
  )</code></pre>
</div>
<div id="leaflet-options" class="section level2">
<h2>Leaflet options</h2>
<p>There are tons of things you can change! Lots of information is available on the <a href="https://rstudio.github.io/leaflet/">RStudio page for leaflet</a>.</p>
<div id="basemap" class="section level3">
<h3>Basemap</h3>
<p>I recommend checking out <code>?addProviderTiles</code> in particular. The Stamen Toner map is a very simple, black and white basemap I like.</p>
</div>
<div id="colors" class="section level3">
<h3>Colors</h3>
<p>The colors from RColorBrewer are based on <a href="http://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">ColorBrewer</a>. You can see all the available palettes by using <code>display.brewer.all()</code>.</p>
<pre class="r"><code>display.brewer.all(type=&quot;seq&quot;)</code></pre>
</div>
<div id="legends" class="section level3">
<h3>Legends</h3>
<p>You can customize your legend– check out <code>?addLegend</code> to see options. In particular, you might want to adjust the <code>bins</code>.</p>
</div>
<div id="saving" class="section level3">
<h3>Saving</h3>
<p>The easiest way is probably just to “knit” your RMarkdown document. Another option could be</p>
<pre class="r"><code>library(htmlwidgets)
saveWidget(m, file=&quot;m.html&quot;)</code></pre>
</div>
</div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">Created by <a href="http://www.science.smith.edu/~amcnamara">Amelia McNamara</a>.</p>
      </div>
    </div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
